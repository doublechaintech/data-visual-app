<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>ECharts</title>
    
    <!-- 引入 echarts.js -->
    <script type="text/javascript" src="echarts.js"></script>
    <!-- 引入jquery.js -->
    <script type="text/javascript" src="jquery-3.3.1.js"></script>
	<script type="text/javascript" src="mychart.js"></script>
</head>

<body>
<div id="charts">
	
	</div>
<script type="text/javascript">
	
	var renderMap = {
						"day":getDayOption,"week":getWeekOption,
					    "month":getMonthOption,"year":getYearOption};
	const url = new URL(window.location);
	const urlPrefix = url.origin;
$.ajax({
         type : "get",
         async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
         url : urlPrefix + "/queryAllStatictice",    //请求发送到TestServlet处
         dataType : "json",        //返回数据形式为json
         success : function(result) {
             if (result) {
					var colors = ['#d8aeff', '#0a4fff'];
					var allCharts = new Array(result.length*2);
					var count = 0;
                    for(var i=0;i<result.length;i++, count++) {
                       $("#charts").append('<div style="width: 600px;height:400px;" id="chart' + count + '"></div>');
					   const data = result[i];
					   //alert($("#charts");
					   //allCharts[i] = echarts.init($("#chart" + i));
					   allCharts[count] = echarts.init(document.getElementById('chart' + count));
					   if ('top' != data.type) {
						   var renderFunction = renderMap[data.type];
						   var option = renderFunction(data,colors);
						   allCharts[count].setOption(option);
					   } else if (data.items) {
							var option = getPieOption(data, colors);
							allCharts[count].setOption(option);
							count++;
							$("#charts").append('<div style="width: 600px;height:400px;" id="chart' + count + '"></div>');
							allCharts[count] = echarts.init(document.getElementById('chart' + count));
							var option1 = getBarOption(data, colors);
							allCharts[count].setOption(option1);
					   }
					   
                     }
                    
             }
         
        },
         error : function(errorMsg) {
           
         alert("图表请求数据失败!");
         }
    })
	</script>
</body>
</html> 